---
// src/components/DirectoryPreview.astro
import { supabase } from '../lib/supabase';

// Fetch the top 3 helpers from Supabase
const { data: helpers, error } = await supabase
  .from('helpers')
  .select('*')
  .limit(3);

const displayHelpers = helpers || [];
---

<section id="browse" class="py-32 bg-white relative border-y border-brand-blue/5">
  <div class="max-w-7xl mx-auto px-6 md:px-12">
    
    <div class="flex flex-col md:flex-row md:items-end justify-between mb-16 reveal">
      <div class="max-w-2xl">
        <span class="text-[0.65rem] uppercase tracking-[0.3em] text-brand-blue font-bold mb-4 block">The Database</span>
        <h2 class="text-4xl md:text-5xl font-serif text-brand-text tracking-tight mb-4">Curated Professionals</h2>
        <p class="text-brand-text/80 font-normal leading-relaxed">Browse a preview of our carefully vetted selection of domestic helpers. Strict confidentiality maintained.</p>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
      
      {displayHelpers.length > 0 ? (
        displayHelpers.map((helper, index) => (
          <div class={`bg-brand-cream border border-brand-blue/10 p-8 shadow-sm hover:shadow-premium-hover transition-all duration-500 reveal delay-${(index + 1) * 100} flex flex-col h-full group`}>
            <div class="flex items-start justify-between mb-8 pb-8 border-b border-brand-blue/10">
              <div class="flex items-center gap-5">
                <div class="w-12 h-12 bg-white flex items-center justify-center text-brand-blue shadow-sm transition-colors">
                  <i data-lucide="user" class="w-5 h-5"></i>
                </div>
                <div>
                  <h3 class="text-xl font-serif text-brand-text mb-1 font-bold">{helper.name}</h3>
                  <p class="text-[0.65rem] text-brand-text/70 font-bold uppercase tracking-[0.2em]">Ref: {helper.reference_code}</p>
                </div>
              </div>
              <span class="text-[0.65rem] uppercase tracking-[0.2em] text-brand-text/80 font-bold">{helper.nationality}</span>
            </div>
            
            <div class="grid grid-cols-2 gap-y-6 gap-x-4 text-sm text-brand-text/90 mb-8 flex-grow">
              <div class="flex flex-col"><span class="text-[0.65rem] uppercase tracking-wider text-brand-text/60 font-bold mb-1">Age</span><span class="font-medium">{helper.age} Years</span></div>
              <div class="flex flex-col"><span class="text-[0.65rem] uppercase tracking-wider text-brand-text/60 font-bold mb-1">Experience</span><span class="font-medium">{helper.experience}</span></div>
              <div class="flex flex-col"><span class="text-[0.65rem] uppercase tracking-wider text-brand-text/60 font-bold mb-1">Status</span><span class="font-medium">{helper.marital_status}</span></div>
              <div class="flex flex-col"><span class="text-[0.65rem] uppercase tracking-wider text-brand-text/60 font-bold mb-1">Religion</span><span class="font-medium">{helper.religion}</span></div>
            </div>

            <div class="mb-10">
              <p class="text-[0.65rem] uppercase tracking-wider text-brand-text/60 font-bold mb-3">Core Expertise</p>
              <div class="flex flex-wrap gap-2">
                {helper.skills && Array.isArray(helper.skills) && helper.skills.map((skill: string) => (
                  <span class="px-3 py-1.5 bg-white text-brand-text text-xs font-medium border border-brand-blue/10 shadow-sm">{skill}</span>
                ))}
              </div>
            </div>

            <a 
              href={`https://wa.me/6581522260?text=Hi%20Alexis%20Employment,%20I%20would%20like%20to%20inquire%20about%20Helper%20Ref:%20${helper.reference_code}`} 
              target="_blank" 
              rel="noopener noreferrer" 
              class="w-full py-4 text-center bg-brand-blue text-white text-xs uppercase tracking-[0.15em] font-bold hover:bg-brand-text transition-all duration-300 mt-auto flex items-center justify-center gap-3 shadow-premium"
            >
              <i data-lucide="message-circle" class="w-4 h-4"></i>
              Inquire Now
            </a>
          </div>
        ))
      ) : (
        <div class="col-span-full py-12 text-center border border-brand-blue/10 bg-brand-cream">
          <p class="text-brand-text/60 font-medium">Connecting to secure database...</p>
        </div>
      )}

    </div>

    <div class="text-center reveal delay-300">
      <a href="/directory" class="inline-flex items-center justify-center px-10 py-4 bg-transparent border border-brand-text text-brand-text font-bold text-xs uppercase tracking-[0.15em] hover:bg-brand-text hover:text-white transition-colors duration-500 group">
        Browse All Helpers
        <i data-lucide="arrow-right" class="w-4 h-4 ml-3 group-hover:translate-x-1 transition-transform"></i>
      </a>
    </div>

  </div>
</section>